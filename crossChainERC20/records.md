### 简单的跨链交互

项目目标：

本项目旨在实现一个简单的跨链资产转移系统，模拟现实中区块链之间的资产桥接（Bridge）功能，完成从**一条链上销毁代币（burn）并在另一条链上铸造代币（mint）**的过程，验证事件监听、交易广播和多链交互的基本流程。



### 技术栈与工具

- **Solidity 0.8.10** — 编写 ERC-20 兼容的跨链桥合约
- **OpenZeppelin** — 安全继承 ERC20、Ownable 等模块
- **Ethers.js v6** — 用于事件监听、交易签名与发送
- **Remix** — 合约部署与交互调试
- **Alchemy RPC** — 分别接入 Sepolia、Holesky 等测试网络
- **Node.js** — 编写监听脚本，实现链间交互逻辑



### 实现功能：

1、销毁当前链上用户代币（调用 _burn），并触发 Bridge 事件

2、由合约所有者调用，向另一条链上的用户地址铸造同数量代币

3、JS 脚本监听 Bridge 事件，在目标链自动调用 mint() 实现跨链

4、mint() 函数受 onlyOwner 修饰，防止任意用户滥用



### 跨链桥测试前的思路记录

1）、选择个人钱包，将合约部署到holesky和sepolia链上

2）、运行js脚本，开始监听事件

3）、在链上铸造代币，查看监听事件是否输出记录

#### 开始尝试：

**1、错误**：代码报错`could not coalesce error`（contractSepoliaAddress监听报错）

发现Ethereum sepolia存在有些链上功能不支持监听的操作

解决思路：重新选择合适的链进行部署和测试

**2、问题**：连续部署在remixd上的两个不同链上的合约，在切换钱包网络时，已经部署的合约会消失

问题解决思路：

1）、启动不同浏览器的remix

2）、操作已经部署的合约

**3、问题**：链上可能不支持事件监听，导致没有Mint成功

执行思路：

1、新增和修改代码进行测试，如：测试合约地址、钱包地址是否出错，测试正常

2、重新选择链进行交互，通过etherscan.io查询相应的内容，仍然无交易内容

3、检查交易哈希、交易状态和交易日志，发现哈希交易被ethers生成，但是无交易记录（幽灵交易）

解决思路：

重新检查每个步骤，在每项数据正确后发现使用的一条区块链不支持广播事件，无法生成Mint事件，

导致交易查询失败。更换至以太坊下两条测试链时，跨链交互成功。



### 跨链的总结记录

### 1、错误记录编号

#### 标题：**交易状态为成功（status = 1），但 Etherscan 查不到交易哈希**

#### 我的思考：

- 交易执行成功了？怎么区块链上查不到？
- 是不是 Mint 事件没有 emit？
- 是不是合约地址不对？

#### 我的尝试：

- 检查合约地址是否和部署时一致 ✅
- 检查 ABI 是否包含 mint/bridge 函数 ✅
- 使用 `tx.wait()` 并打印 `tx.hash`、`tx.status` ✅
- 使用 `interface.fragments.map(f => f.name)` 确认合约方法 ✅
- 检查合约是否 emit 了 Mint ✅

#### ✅ 最终定位：

> 使用了 zkSync 的 Sepolia RPC 地址： `https://zksync-sepolia.g.alchemy.com/...` 而合约是部署在以太坊原生的 Sepolia 网络。

**错误本质**：网络不一致 → 合约地址、区块数据、交易广播完全失效 **解决方案**：使用正确的以太坊 Sepolia RPC： `https://eth-sepolia.g.alchemy.com/v2/YOUR_KEY`

------

### 2、错误记录编号

#### 标题：**Mint 事件在 Remix 中能看到，但通过 JS 铸币后无法在 Etherscan 中看到任何事件**

#### 我的思考：

- 是不是没有 emit？
- 是不是合约写错？
- 是不是监听失败？

#### 我的尝试：

- 在合约中明确添加 `emit Mint(...)` ✅
- 在 JS 中监听 `Mint`、`Bridge` 事件 ✅
- 使用 `queryFilter()` 手动查询 ✅
- 打印 `receipt.logs` 查看交易日志 ✅

#### ✅ 最终定位：

> 交易其实根本没有上链（幽灵交易），导致根本不会触发事件！

**错误本质**：JS 获取了一个本地构建的 tx 对象，但因为网络错误，链上不存在这个交易，事件自然无从谈起。

解决方案**：修复网络后，重新广播交易，事件立即出现 ✅

------

### 3、错误记录编号

#### 标题：**通过 JS 成功发起了 mint 交易，收到了交易哈希，但在 Etherscan 查不到任何内容**

#### 我的思考：

- 是不是 Etherscan 有延迟？
- 是不是交易失败回滚了？
- 是不是我合约地址用错了？

#### 我的尝试：

- 打印交易状态（status = 1）✅
- 使用 JS 查看 `receipt.logs` ✅
- 打印实际使用的合约地址和钱包地址 ✅
- 试图在 Etherscan 查交易哈希 ❌（查不到）

#### ✅ 最终定位：

> **Ethers.js 返回的交易是假的（签名但未广播）**，因为使用了错误链的 RPC，导致：
>
> - 本地生成的 txHash 存在
> - 但交易永远不会出现在该链上

**错误本质**：网络之间的“平行宇宙”问题（同样的地址、同样的代码，但不同链）

**解决方案**：换成正确 RPC，交易立即生效 ✅

------

### 4、错误记录编号

#### 标题：**合约监听到了 Bridge 事件，但 mint 执行无任何效果**

#### 我的思考：

- 是不是调用了错误的合约地址？
- 是不是合约没铸币？
- 是不是 `wallet` 权限不对？

#### 我的尝试：

- 打印合约地址 ✅
- 检查钱包权限 ✅
- 手动监听合约事件 ✅

#### ✅ 最终定位：

> 合约地址是对的，但 **该合约并不在你连接的链上**

**错误本质**：合约地址虽然看起来对，但因为链错了，它不是“你部署的那份”。

**解决方案**：重新部署到正确链上 ✅

------

### 5、错误记录编号

#### 标题：**在 JS 中监听不到任何事件，即使合约 emit 正确**

#### 我的思考：

- 是不是事件没发出来？
- 是不是 `.on()` 不生效？
- 是不是 RPC 不支持？

#### 我的尝试：

- `contract.on("Bridge", async ...)` ✅
- 使用 `queryFilter()` 轮询 ✅
- 打印监听状态 ✅

#### ✅ 最终定位：

> 使用的是 HTTP Provider，不能触发 `.on()` 的订阅逻辑 并且是错误链 → 双重导致监听无效

**错误本质**：监听失败 + 链不一致

**解决方案**：

- 使用 `WebSocketProvider` ✅
- 正确链 ✅

